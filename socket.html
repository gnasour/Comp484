<!doctype html>
<html lang="en">

<head>
    <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.js'>

    </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb"
        crossorigin="anonymous">
    <script type='text/javascript'>
        var myID = null;
        var total = 0;
        var firstAce = false;
        var deletedTen = false;
        var bust = false;
        var stand = false;
        var socket = io('http://localhost:3000', { path: '/' }); // connect to server

        function hitMe() {
            socket.emit('fromClient', { action: "hit", player_total: total });
        }
        function stand(){
            stand = true;
            document.getElementById("hit").disabled = true;
            alert("User stands");
            socket.emit('fromClient', {action: "stand"})

        }
        function newGame() {
            total = 0;
            firstAce = false;
            deletedTen = false;
            bust = false;
            document.getElementById("hit").disabled = false;
            document.getElementById('hand1').innerHTML = "";
            document.getElementById('hand2').innerHTML = "";
            document.getElementById('hand3').innerHTML = "";
            document.getElementById('hand4').innerHTML = "";
            document.getElementById('hand5').innerHTML = "";
            socket.emit('fromClient', { action: "new_game" });
        }
        function checkGame() {
            if (total > 21) {
                if (firstAce === true && deletedTen === false) {
                    total -= 10;
                    firstAce = false;
                    deletedTen = true;
                }
                else{
                    alert("Bust! Start A New Game");
                    document.getElementById("hit").disabled = true;
                }
            }
        }
        socket.on('fromServer', function (data) {

            if (data.id && (myID == null)) {
                myID = data.id;
                console.log(myID);
            }
            else if (data.card && document.getElementById('hand1').innerHTML.length === 0) {
                document.getElementById('hand1').innerHTML = data.card;
                if (total >= 11 && data.value === 11) {
                    total += 1;
                }
                else if (total < 11 && data.value === 11) {
                    total += 11;
                    firstAce = true;
                }
                else
                    total += data.value;
                checkGame();
                document.getElementById('current_total').innerHTML = total;

            }
            else if (data.card && document.getElementById('hand2').innerHTML.length === 0) {
                document.getElementById('hand2').innerHTML = data.card;
                if (total >= 11 && data.value === 11) {
                    total += 1;
                }
                else if (total < 11 && data.value === 11) {
                    total += 11;
                    firstAce = true;
                }
                else
                    total += data.value;
                checkGame();
                document.getElementById('current_total').innerHTML = total;

            }
            else if (data.card && document.getElementById('hand3').innerHTML.length === 0) {
                document.getElementById('hand3').innerHTML = data.card;
                if (total >= 11 && data.value === 11) {
                    total += 1;
                }
                else if (total < 11 && data.value === 11) {
                    total += 11;
                    firstAce = true;
                }
                else
                    total += data.value;
                checkGame();
                document.getElementById('current_total').innerHTML = total;

            }
            else if (data.card && document.getElementById('hand4').innerHTML.length === 0) {
                document.getElementById('hand4').innerHTML = data.card;
                if (total >= 11 && data.value === 11) {
                    total += 1;
                }
                else if (total < 11 && data.value === 11) {
                    total += 11;
                    firstAce = true;
                }
                else
                    total += data.value;
                checkGame();
                document.getElementById('current_total').innerHTML = total;

            }
            else if (data.card && document.getElementById('hand5').innerHTML.length === 0) {
                document.getElementById('hand5').innerHTML = data.card;
                if (total >= 11 && data.value === 11) {
                    total += 1;
                }
                else if (total < 11 && data.value === 11) {
                    total += 11;
                    firstAce = true;
                }
                else
                    total += data.value;
                checkGame();
                document.getElementById('current_total').innerHTML = total;
            }
        });
    </script>
</head>

<body>
    <div class="container">
            <div class="row" >
                    <div class="col" >
                        <p id='dealer_hand1' class="text-justify">a</p>
                    </div>
                    <div class="col" >
                        <p id='dealer_hand2' class="text-justify">a</p>
                    </div>
                    <div class="col" >
                        <p id='dealer_hand3' class="text-justify">a</p>
                    </div>
                    <div class="col" >
                        <p id='dealer_hand4' class="text-justify">a</p>
                    </div>
                    <div class="col" >
                        <p id='dealer_hand5' class="text-justify">a</p>
                    </div>
    </div>
    <div class="container">
        <div class="row" style="top: 500px;">
            <div class="col" style="top: 500px;left: 235px;">
                <p id='hand1' class="text-justify"></p>
            </div>
            <div class="col" style="top: 500px;left: 45px;">
                <p id='hand2' class="text-justify"></p>
            </div>
            <div class="col" style="top: 500px;right: 145px;">
                <p id='hand3' class="text-justify"></p>
            </div>
            <div class="col" style="top: 500px;right: 340px;">
                <p id='hand4' class="text-justify"></p>
            </div>
            <div class="col" style="top: 500px;right: 535px;">
                <p id='hand5' class="text-justify"></p>
            </div>

        </div>
        <div class="row">
            <div class="col">
                <div class="col" style="top: 450px;left: 500px;">
                    Your Total:
                    <p id='current_total' class="text-justify"></p>
                </div>
            </div>
            <div class="col-6" style="border-top-width: 10px;top: 500px;">
                <button onclick="hitMe()" id="hit">Hit!</button>
                <button onclick="stand()" id="stand">Stand</button>
                <button onclick="newGame()">New Game!</button>
            </div>
            <div class="col">

            </div>
        </div>
    </div>
</body>

</html>